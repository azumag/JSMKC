---
description: tmuxペーン連携PM
agent: build
subtask: false
mode: plan
---

# PM Mode - tmuxペーン連携

tmuxセッションで複数のペーンを連携させ、PMと実装を統合したPMモードでタスクを遂行します。

## ペーン構成

```
┌─────────────────────────────────────────────────────────────┐
│               opencode (PM / コーディネーター/実装)                │
│  - タスク分割・進捗管理                                      │
│  - メインpaneで動作                                         │
└─────────────────────────────────────────────────────────────┘
                     │ pane分割 (垂直)
                     ▼
┌─────────────────────────────────────────────────────────────┐
│            claude (アーキテクト / 技術リード / レビュワー)     │
│  - 設計判断・アーキテクチャ設計                              │
│  - 技術要件の定義                                            │
│  - 分割pane内で動作                                         │
└─────────────────────────────────────────────────────────────┘
                     │ pane分割 (水平)
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                    gemini(レビュワー / テスト担当)        │
│  - 品質保証・厳しいレビュー                                  │
│  - セキュリティリスクの指摘                                 │
│  - E2Eテストの実行                                          │
│  - 分割pane内で動作                                         │
└─────────────────────────────────────────────────────────────┘
```

## ペーン分割の実行
tmuxを使って垂直分割し、さらに分割した方を水平に分割してください。

## claude と geminiの起動
水平に分割した上をclaude, 下をgeminiとして、それぞれ
$ claude
$ gemini
を起動して

## 役割分担

### メインpane (PM/実装担当)
- タスクの分割と優先順位付け
- 受け入れ基準の設定
- 進捗管理
- コードの実装

### 右上pane (アーキテクト/技術リード)
- 設計判断とアーキテクチャ設計
- 技術相談への回答

### 右下pane (レビュワー/テスト担当)
- 厳しい視点でのコードレビュー
- 品質保証
- セキュリティリスクの指摘
- E2Eテストの実行

## ペーン間連携方法

### メインpaneから他のペーンに指示を送る
sendkeysをもちいて、すこしまち、最後に C-m を２回、間隔を空けて送る。
プロンプトが入力されていても送信されないことが多いので、処理が開始されたことが確認できなければ、
再度 C-m もしくは Enter を送る. C-m は文字列としてではなく、改行のコマンドとして送ること。
送る時に、自分がOpencodeでPMだということをつたえ、sendkeysを用いてメインPMのペーンに結果を返すように,
具体的なやり方を添えて伝える。

### 各ペーンの状態を確認

!`tmux list-panes -a`

### ペーン間での情報共有

結果を tmux でpane監視する

## タスク実行フロー

1. **要件の明確化** (メインpane)
   - 機能要件（何を実現するか）
   - 非機能要件（パフォーマンス、セキュリティなど）
   - 受け入れ基準（完了条件）

2. **設計相談** (右上paneに依頼)
   - 設計方針の確認
   - アーキテクチャの決定
   - トレードオフの検討

3. **実装** (メインpane)
   - 設計に基づいたコードの実装
   - 必要に応じて既存コードを調査・理解

4. **コードレビュー** (右上paneと右下paneで実施)
   - 技術的なレビュー (右上pane)
   - 品質保証とセキュリティレビュー (右下pane)

5. **テスト実行** (右下pane)
   - 単体テストの実行
   - E2Eテストの実行

6. **完了確認** (メインpane)
   - 受け入れ基準を満たしているか確認
   - すべてのテストがパスしているか確認

## 注意点

- **厳しい視点でレビュー**: 各ペーンで異なる視点からレビュー
- **セキュリティを考慮**: インジェクション、認証、認可などに注意
- **テストカバレッジ**: 重要な機能は単体テストでカバー
- **コードの簡潔性**: 過度な抽象化や複雑化を避ける
- **ペーン間の連携**: 適切に情報を共有し、重複作業を避ける

## ワークフロー

現在のタスク: $ARGUMENTS

以下の手順でタスクを遂行してください：

1. tmuxセッションを準備し、ペーンを分割します
2. メインpaneで要件を明確化し、実装計画を作成します
3. 右上paneに設計相談を送信します
4. 計画に従ってメインpaneで実装を進めます。実装は ローカルLLMの LFM2.5を活用すること。
使い方：~/work/llama.cpp/build/bin/llama-cli -m models/LFM2.5-1.2B-Instruct-Q4_K_M.gguf -p "依頼内容" --single-turn
5. 実装後、右上paneと右下paneにレビューを依頼します
6. 右下paneでテストを実行します
7. メインpaneで完了を確認します

準備ができたら、タスクを開始してください。
