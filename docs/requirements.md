# JSMKC 点数計算システム 要件定義書

## 1. 概要

### 1.1 システム目的
Japan Super Mario Kart Championship (JSMKC) の大会運営における点数計算・順位管理を行うシステム

### 1.2 対象大会
- JSMKC2024 およびそれ以降の大会

---

## 2. 大会共通仕様

### 2.1 プレイヤー
- **最大プレイヤー数**: 48人程度
- **キャラクター**: 競技中に変更可能
- **2プレイヤーモード**: 1P/2P側の割り当ては運営が決定（試合中は固定）

### 2.2 使用機材
- **ハードウェア**: 任天堂純正スーパーファミコン実機（NTSC規格）
- **コントローラー**: スーパーファミコン用であれば制限なし
  - 十字キーの左+右同時押しも許可

---

## 3. 競技モード

JSMKC2024では以下の3つの競技モードが存在する：

| モード | 形式 | 特徴 |
|--------|------|------|
| タイムアタック | 個人戦 | タイム計測による順位決定 |
| バトル | 1vs1対戦 | 風船を割り合うバトル |
| vsマッチレース | 1vs1対戦 | レース対決 |
| vsグランプリ | 1vs1対戦 | カップ戦でドライバーズポイント勝負 |

---

## 4. タイムアタックモード

### 4.1 予選ラウンド

#### 形式
- **コース数**: 全20コース
- **スコア計算**: 全コースの合計タイム
- **順位決定**: 合計タイムが短い順

#### データ構造
```
予選結果 {
  プレイヤーID
  コース別タイム[20]
  合計タイム
  予選順位
}
```

### 4.2 敗者復活ラウンド（1回目）

#### 参加条件
- 予選順位: 17位〜24位（8人）

#### 形式
- 運営が選んだコースを走行
- **最下位が脱落**（サドンデス方式）
- **4人になるまで**繰り返す

#### 進行
```
8人 → 7人 → 6人 → 5人 → 4人（終了）
```

### 4.3 敗者復活ラウンド（2回目）

#### 参加条件
- 予選順位: 13位〜16位（4人）
- 敗者復活1回目の生存者（4人）
- **合計8人**

#### 形式
- 運営が選んだコースを走行
- **最下位が脱落**（サドンデス方式）
- **4人になるまで**繰り返す

### 4.4 決勝トーナメント

#### ライフ制ルール
| 項目 | 値 |
|------|-----|
| 初期ライフ | 3 |
| ライフ減少条件 | タイム下位半分 |
| 脱落条件 | ライフ0 |

#### ライフリセットポイント
以下の人数到達時にライフがリセット（全員3に復帰）：
- TOP16 → TOP8
- TOP8 → TOP4
- TOP4 → TOP2
- TOP2 → TOP1（優勝決定）

#### 進行例（TOP16の場合）
```
16人全員ライフ3でスタート
  ↓
1コース走行 → 下位8人がライフ-1
  ↓
繰り返し（ライフ0で脱落）
  ↓
8人になったらライフリセット
```

---

## 5. バトルモード

### 5.1 予選ラウンド

#### 形式
- **グループ数**: 2グループ
- **対戦形式**: グループ内総当たり
- **使用コース**: バトルコース1〜4（4コース順番）

#### 勝ち点システム
| 結果 | 勝ち点 |
|------|--------|
| 勝ち越し（3勝以上） | 2点 |
| 引き分け（2勝2敗） | 1点 |
| 負け越し（1勝以下） | 0点 |

#### データ構造
```
バトル予選結果 {
  プレイヤーID
  グループ
  対戦結果[] {
    対戦相手ID
    コース別勝敗[4]  // Win/Lose/Draw
    勝敗数
    獲得勝ち点
  }
  総勝ち点
  グループ順位
}
```

### 5.2 敗者復活ラウンド

#### 形式
- **3勝先取**
- 勝者が次のラウンドへ進出

### 5.3 決勝トーナメント

#### 形式
- **ダブルエリミネーション方式**
  - 2回負けると敗退
  - ウィナーズブラケット / ルーザーズブラケット

#### 勝利条件
- **5勝先取** または **7勝先取**（運営が決定）

### 5.4 グランドファイナル

#### 対戦者
- ウィナーズブラケット優勝者（無敗）
- ルーザーズブラケット優勝者（1敗）

#### 特別ルール
- 無敗側は**1回負けても再戦可能**
- 1敗側は**1回負けで敗退**

---

## 6. vsマッチレースモード

### 6.1 予選ラウンド

#### 形式
- **グループ数**: 2グループ
- **対戦形式**: グループ内総当たり
- **使用コース**: ランダム4コース（スペシャルカップ含む全20コース対象）

#### 勝ち点システム
| 結果 | 勝ち点 |
|------|--------|
| 勝ち越し（3勝以上） | 2点 |
| 引き分け（2勝2敗） | 1点 |
| 負け越し（1勝以下） | 0点 |

### 6.2 敗者復活ラウンド

#### 形式
- **3勝先取**
- 勝者が次のラウンドへ進出

### 6.3 決勝トーナメント

#### 形式
- **ダブルエリミネーション方式**
- **5勝先取** または **7勝先取**

### 6.4 グランドファイナル

- 無敗側は**1回負けても再戦可能**

---

## 7. vsグランプリモード

### 7.1 予選ラウンド

#### 形式
- **グループ数**: 2グループ
- **対戦形式**: グループ内総当たり
- **使用カップ**: 4カップから運営が選択

#### 勝敗判定
- **ドライバーズポイント**の合計で判定

#### ドライバーズポイント（参考）
| 順位 | ポイント |
|------|----------|
| 1位 | 9点 |
| 2位 | 6点 |
| 3位 | 3点 |
| 4位 | 1点 |
| 5位以下 | 0点 |

#### 勝ち点システム
| 結果 | 勝ち点 |
|------|--------|
| 勝ち越し | 2点 |
| 引き分け | 1点 |
| 負け越し | 0点 |

### 7.2 敗者復活ラウンド

#### 形式
- **勝者が次のラウンドへ進出**

### 7.3 決勝トーナメント

#### 形式
- **ダブルエリミネーション方式**
- **2勝先取** または **3勝先取**

### 7.4 グランドファイナル

- 無敗側は**1回負けても再戦可能**

---

## 8. システム機能要件

### 8.1 プレイヤー管理
- [ ] プレイヤー登録（最大48人）
- [ ] プレイヤー情報編集
- [ ] 使用キャラクター記録

### 8.2 タイムアタック機能
- [ ] コース別タイム入力
- [ ] 合計タイム自動計算
- [ ] 予選順位自動計算
- [ ] 敗者復活ラウンド管理
- [ ] ライフ制トーナメント管理
- [ ] ライフリセット自動処理

### 8.3 バトル/マッチレース機能
- [ ] グループ分け機能
- [ ] 総当たり対戦表生成
- [ ] コース別勝敗入力
- [ ] 勝ち点自動計算
- [ ] 敗者復活ラウンド管理
- [ ] ダブルエリミネーショントーナメント管理

### 8.4 vsグランプリ機能
- [ ] カップ選択
- [ ] ドライバーズポイント入力/計算
- [ ] 勝敗判定

### 8.5 共通機能
- [ ] リアルタイム順位表示
- [ ] 結果エクスポート
- [ ] 履歴管理

---

## 9. 用語集

| 用語 | 説明 |
|------|------|
| JSMKC | Japan Super Mario Kart Championship |
| ダブルエリミネーション | 2回負けると敗退するトーナメント形式 |
| ウィナーズブラケット | まだ負けていないプレイヤーのトーナメント枠 |
| ルーザーズブラケット | 1回負けたプレイヤーのトーナメント枠 |
| サドンデス | 最下位が即脱落する方式 |
| ドライバーズポイント | グランプリモードでの順位に応じた得点 |

---

## 10. 改訂履歴

| バージョン | 日付 | 内容 |
|------------|------|------|
| 1.0 | 2024-12-07 | 初版作成 |
